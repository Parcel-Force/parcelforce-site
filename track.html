<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ParcelForce | Live Tracker</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
/*** ParcelForce ‚Äî Redesigned track.html ***/
:root {
  --brand-red: #9B0F22;
  --brand-red-2: #7F0D1A;
  --brand-navy: #0b3d91;
  --muted: #6b7280;
  --bg: #f7f8fb;
  --card: #ffffff;
  --glass: rgba(255,255,255,0.6);
  --radius: 12px;
  --container: 1200px;
  --shadow-lg: 0 12px 40px rgba(2,6,23,0.12);
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  font-family: Inter, "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
  background: linear-gradient(180deg, #ffffff, #f3f6fb 40%);
  color: #0f1724;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  line-height: 1.45;
}

.wrap {
  width: min(96%, var(--container));
  margin: 20px auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 18px;
  padding-bottom: 48px;
}

header.track-header {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  background: var(--card);
  padding: 12px 16px;
  border-radius: 14px;
  box-shadow: var(--shadow-lg);
  border-left: 4px solid var(--brand-red);
}

.brand {
  display: flex;
  gap: 12px;
  align-items: center;
}

.brand img {
  height: 40px;
  width: auto;
  border-radius: 8px;
}

.brand h1 {
  font-size: 1rem;
  margin: 0;
  font-weight: 700;
  color: var(--brand-navy);
}

.breadcrumbs {
  font-size: 0.9rem;
  color: var(--muted);
}

.actions {
  display: flex;
  gap: 8px;
  align-items: center;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  font-weight: 600;
  font-size: 0.95rem;
  border-radius: 10px;
  cursor: pointer;
  border: none;
}

.btn-ghost {
  background: transparent;
  color: var(--brand-navy);
  border: 1px solid rgba(11,61,145,0.06);
}

.btn-primary {
  background: linear-gradient(90deg, var(--brand-red), var(--brand-red-2));
  color: #fff;
  box-shadow: 0 8px 24px rgba(155,15,34,0.12);
}

main {
  display: grid;
  grid-template-columns: 1fr;
  gap: 18px;
}

.card {
  background: var(--card);
  padding: 16px;
  border-radius: 14px;
  box-shadow: var(--shadow-lg);
  border: 1px solid rgba(15,23,36,0.04);
}

.summary {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.summary .meta {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
}

.tracking {
  display: flex;
  gap: 12px;
  align-items: center;
  min-width: 0;
}

.tracking .code {
  font-weight: 800;
  color: var(--brand-red);
  font-size: 1.15rem;
  background: linear-gradient(90deg, rgba(155,15,34,0.06), transparent);
  padding: 8px 12px;
  border-radius: 10px;
}

.tracking .copy {
  background: transparent;
  border: 1px solid rgba(15,23,36,0.06);
  padding: 8px;
  border-radius: 8px;
  font-weight: 700;
  cursor: pointer;
}

.meta .updated {
  color: var(--muted);
  font-size: 0.95rem;
}

.progress-row {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.progress-bar {
  background: #eef2f6;
  height: 14px;
  border-radius: 999px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--brand-red), var(--brand-red-2));
  width: 0%;
  transition: width 0.6s cubic-bezier(0.2, 0.9, 0.2, 1);
  box-shadow: 0 6px 24px rgba(155,15,34,0.08);
}

.timeline {
  display: flex;
  gap: 8px;
  justify-content: space-between;
  align-items: center;
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: 6px;
}

.timeline .step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  flex: 1;
  text-align: center;
}

.timeline .dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #e6eefc;
  border: 3px solid rgba(11,61,145,0.08);
}

.timeline .dot.active {
  background: var(--brand-red);
  box-shadow: 0 6px 20px rgba(155,15,34,0.12);
  border-color: transparent;
}

.map-wrap {
  min-height: 240px;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
}

#map {
  width: 100%;
  height: 100%;
  min-height: 260px;
  display: block;
}

.map-fallback {
  display: none;
  padding: 24px;
  text-align: center;
  color: var(--muted);
}

.details {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.recipient, .status, .qr-area {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.recipient .row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
}

.recipient .label {
  color: var(--muted);
  font-weight: 700;
  width: 110px;
}

.status-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.status-item {
  background: #fbfdff;
  border-radius: 10px;
  padding: 10px;
  border-left: 4px solid var(--brand-red);
  font-weight: 600;
}

.qr-canvas {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 16px;
}

footer.track-footer {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: transparent;
  color: var(--muted);
  font-size: 0.95rem;
}

@media (min-width: 880px) {
  .wrap { gap: 20px; }
  main {
    grid-template-columns: 1fr 360px;
    align-items: start;
  }
  .summary {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }
  .map-wrap { min-height: 420px; }
}

a:focus, button:focus, input:focus {
  outline: 3px solid rgba(11,61,145,0.12);
  outline-offset: 2px;
  border-radius: 8px;
}

@media (prefers-reduced-motion: reduce) {
  .progress-fill, .timeline .dot, .card {
    transition: none !important;
    animation: none !important;
  }
}
</style>
</head>

<body>
<div class="wrap" role="main">
  <header class="track-header" aria-label="Tracking header">
    <div class="brand">
      <img src="logo.png" alt="ParcelForce logo" />
      <div>
        <h1>ParcelForce Live Tracker</h1>
        <div class="breadcrumbs" aria-hidden="true">Home / Tracking</div>
      </div>
    </div>
    <div class="actions">
      <button class="btn btn-ghost" id="copyBtn" title="Copy tracking number">Copy</button>
      <button class="btn btn-ghost" id="shareBtn" title="Share tracker">Share</button>
      <button class="btn btn-primary" id="backBtn" title="Back to home" onclick="location.href='index.html'">Home</button>
    </div>
  </header>

  <main>
    <!-- LEFT: Map + summary -->
    <section class="card" aria-labelledby="summaryTitle">
      <div class="summary" id="summaryTitle">
        <div class="meta">
          <div class="tracking" aria-live="polite">
            <div class="code" id="trackingCode">PF557690344CN</div>
            <button class="tracking copy" id="copyInline" aria-label="Copy tracking number">üìã</button>
            <div class="updated" id="lastUpdated">Last update: ‚Äî</div>
          </div>
          <div class="meta-actions">
            <button class="btn btn-ghost" id="printBtn" onclick="window.print()">Print</button>
            <button class="btn btn-ghost" id="directionsBtn">Get directions</button>
          </div>
        </div>

        <div class="progress-row">
          <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="progress-fill" id="progressFill" style="width:0%"></div>
          </div>
          <div class="timeline" id="timeline">
            <div class="step">
              <div class="dot" id="dot1"></div>
              <div class="label">Collected</div>
            </div>
            <div class="step">
              <div class="dot" id="dot2"></div>
              <div class="label">In transit</div>
            </div>
            <div class="step">
              <div class="dot" id="dot3"></div>
              <div class="label">Delivered</div>
            </div>
          </div>
        </div>
      </div>

      <hr style="border:none;margin:12px 0 8px;border-top:1px solid rgba(15,23,36,0.04)"/>

      <div class="map-wrap card" aria-label="Live location map">
        <div id="map" role="region" aria-label="Parcel current location map"></div>
        <div class="map-fallback" id="mapFallback">
          Map not available ‚Äî location: <span id="coordsText"></span>
        </div>
      </div>

      <div style="margin-top:12px;">
        <h3 style="margin:0 0 10px 0;color:var(--brand-navy)">Status updates</h3>
        <ul class="status-list" id="statusList" aria-live="polite"></ul>
      </div>
    </section>

    <!-- RIGHT: Details / recipient / QR -->
    <aside class="card details" aria-labelledby="detailsTitle">
      <h2 id="detailsTitle" style="font-size:1.05rem;margin:0 0 6px 0;color:var(--brand-navy)">Shipment details</h2>

      <div class="recipient" aria-label="Sender and recipient">
        <div class="row"><div class="label">Sender</div><div id="senderName">‚Äî</div></div>
        <div class="row"><div class="label">From</div><div id="senderAddress">‚Äî</div></div>
        <div class="row"><div class="label">Receiver</div><div id="recipientName">‚Äî</div></div>
        <div class="row"><div class="label">To</div><div id="recipientAddress">‚Äî</div></div>
        <div class="row"><div class="label">ETA</div><div id="eta">‚Äî</div></div>
      </div>

      <div class="status" style="margin-top:8px;">
        <h3 style="margin:8px 0 6px 0;color:var(--brand-red)">Current checkpoint</h3>
        <div id="currentCheckpoint" class="status-item" aria-live="polite">‚Äî</div>
      </div>

      <p style="background: #fff3cd; padding: 12px; border-radius: 10px; border-left: 4px solid #ff9800; margin-top: 12px;">
        ‚ö†Ô∏è <strong>Parcel On Hold:</strong> Your parcel is currently being held in transit because the Commercial Invoice / Customs Declaration document has not been provided.
      </p>

      <!-- Invoice Section (only shown if invoice exists) -->
      <div class="invoice-section" id="invoiceSection" style="display:none; margin-top:12px; border: 2px solid var(--brand-navy); border-radius: 12px; padding: 16px; background: #f8fbff;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h3 style="margin:0; color:var(--brand-navy); font-size: 1.1rem;">üìÑ Invoice Details</h3>
          <button class="btn btn-ghost" id="downloadInvoiceBtn" style="font-size: 0.85rem; padding: 6px 10px;">Download PDF</button>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 0.95rem;">
          <div style="display: flex; justify-content: space-between;">
            <span style="color: var(--muted); font-weight: 600;">Invoice #:</span>
            <span style="font-weight: 700;" id="invoiceNumber">‚Äî</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: var(--muted); font-weight: 600;">Date Issued:</span>
            <span id="invoiceDate">‚Äî</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: var(--muted); font-weight: 600;">Description:</span>
            <span id="invoiceDesc" style="text-align: right; max-width: 60%;">‚Äî</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span style="color: var(--muted); font-weight: 600;">Weight:</span>
            <span id="invoiceWeight">‚Äî</span>
          </div>
          
          <hr style="border:none; border-top: 1px solid rgba(11,61,145,0.1); margin: 8px 0;" />
          
          <div id="invoiceCharges" style="display: flex; flex-direction: column; gap: 6px;">
            <!-- Charges will be inserted here -->
          </div>
          
          <hr style="border:none; border-top: 1px solid rgba(11,61,145,0.1); margin: 8px 0;" />
          
          <div style="display: flex; justify-content: space-between; font-size: 1.05rem; font-weight: 700;">
            <span style="color: var(--brand-red);">Total Amount:</span>
            <span style="color: var(--brand-red);" id="invoiceTotal">‚Äî</span>
          </div>
          
          <div style="margin-top: 8px; padding: 10px; background: #fff3cd; border-radius: 8px; border-left: 3px solid #ff9800;">
            <span style="font-weight: 600;">Payment Status: </span>
            <span id="paymentStatus" style="font-weight: 700; color: #ff6b00;">‚Äî</span>
          </div>
        </div>
      </div>

      <div class="qr-area" style="margin-top:8px;">
        <h3 style="margin:8px 0 6px 0;color:var(--brand-navy)">QR / Share</h3>
        <div class="qr-canvas" id="qrCodeContainer"></div>
        <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
          <button class="btn btn-ghost" id="downloadQrBtn">Download QR</button>
          <button class="btn btn-primary" id="chatBtn" onclick="window.open('https://wa.me/27633373857','_blank')">WhatsApp Support</button>
        </div>
      </div>
    </aside>
  </main>

  <footer class="track-footer">
    <div>ParcelForce International Courier &copy; <span id="year"></span></div>
    <div>Privacy ‚Ä¢ Terms ‚Ä¢ Accessibility</div>
  </footer>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- QRCode JS -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>

<!-- Main Script -->
<script>
(function() {
  // Sample data - FIXED: All tracking numbers now properly inside SAMPLE object
  const SAMPLE = {
    "PF557690344CN": {
      sender: {
        name: "Woods Loan Office",
        address: "1736 Atlantic Ave, Atlantic City, NJ 08401, United States"
      },
      recipient: {
        name: "Ella Irene Pelling",
        address: "35 Ringley Road, Horsham, West Sussex RH12 4AS England"
      },
      journey: [
        "Collected ‚Äî 04 Nov 2025",
        "Departed hub ‚Äî 24 Nov 2025",
        "Out for delivery ‚Äî 25 Nov 2025"
      ],
      deliveryDate: "2025-11-25",
      checkpoint: "Parcel is currently in transit",
      coords: [51.0629, -0.3270],
      status: "in_transit"
    },
    "RB123456789CN": {
      sender: {
        name: "Pascal Williams",
        address: "103 Notting Hill Gate, Kensington, London W11 3LB",
        phone: "+357 95 585645"
      },
      recipient: {
        name: "Patricia Mavundla",
        address: "St Patrick's Hospital, Bizana 4800, Eastern Cape",
        phone: "+27 84 378 4396"
      },
      journey: [
        "Collected ‚Äî 28 Nov 2025",
        "Cleared export hub ‚Äî 01 Dec 2025",
        "Out for delivery ‚Äî 02 Dec 2025"
      ],
      deliveryDate: "2025-12-02",
      checkpoint: "Parcel is currently in international transit",
      coords: [-26.1392, 28.2460],
      status: "in_transit"
    },
    "PF99564008CN": {
      sender: {
        name: "George Callaghan",
        address: "103 Notting Hill Gate, Kensington, London W11 3LB",
        phone: "+357 95 585645"
      },
      recipient: {
        name: "Nicola Chadayan",
        address: "17 Oxford Road, Bedford Gardens, South Africa",
        phone: "+27 83 444 5181"
      },
      journey: [
        "Collected ‚Äî 28 Nov 2025",
        "Cleared export hub ‚Äî 01 Dec 2025",
        "Out for delivery ‚Äî 02 Dec 2025"
      ],
      deliveryDate: "2025-12-02",
      checkpoint: "Parcel is currently in transit from London to South Africa",
      coords: [-26.2041, 28.0473],
      status: "in_transit",
      invoice: {
        invoiceNumber: "INV-2025-001",
        dateIssued: "2025-12-01",
        description: "International parcel shipment from London to South Africa",
        weight: "2.5 kg",
        charges: [
          { item: "Shipping Fee", amount: 120.00, currency: "GBP" },
          { item: "Insurance", amount: 15.00, currency: "GBP" }
        ],
        totalAmount: { value: 135.00, currency: "GBP" },
        paymentStatus: "Pending"
      }
    }
  };

  // Helper functions
  function qs(id) { return document.getElementById(id); }
  
  function getRefFromURL() {
    const p = new URLSearchParams(location.search);
    return (p.get('ref') || '').toUpperCase() || 'PF557690344CN';
  }
  
  function formatISONow() {
    return new Date().toLocaleString();
  }

  // Get tracking reference
  const ref = getRefFromURL();
  const parcel = SAMPLE[ref];

  // Set year
  qs('year').textContent = new Date().getFullYear();

  // Check if parcel exists
  if (!parcel) {
    document.body.innerHTML = '<div style="padding:40px;text-align:center"><h2>Tracking number not found</h2><p>Please verify and try again.</p></div>';
    return;
  }

  // Populate UI
  qs('trackingCode').textContent = ref;
  qs('lastUpdated').textContent = 'Last update: ' + formatISONow();
  qs('senderName').textContent = parcel.sender.name;
  qs('senderAddress').textContent = parcel.sender.address;
  qs('recipientName').textContent = parcel.recipient.name;
  qs('recipientAddress').textContent = parcel.recipient.address;
  qs('eta').textContent = parcel.deliveryDate;
  qs('currentCheckpoint').textContent = parcel.checkpoint;

  // Populate invoice if exists
  if (parcel.invoice) {
    const invoiceSection = qs('invoiceSection');
    invoiceSection.style.display = 'block';
    
    qs('invoiceNumber').textContent = parcel.invoice.invoiceNumber;
    qs('invoiceDate').textContent = parcel.invoice.dateIssued;
    qs('invoiceDesc').textContent = parcel.invoice.description;
    qs('invoiceWeight').textContent = parcel.invoice.weight;
    qs('paymentStatus').textContent = parcel.invoice.paymentStatus;
    
    // Populate charges
    const chargesContainer = qs('invoiceCharges');
    parcel.invoice.charges.forEach(charge => {
      const chargeDiv = document.createElement('div');
      chargeDiv.style.cssText = 'display: flex; justify-content: space-between;';
      chargeDiv.innerHTML = `
        <span style="color: var(--muted);">${charge.item}:</span>
        <span>${charge.currency} ${charge.amount.toFixed(2)}</span>
      `;
      chargesContainer.appendChild(chargeDiv);
    });
    
    qs('invoiceTotal').textContent = `${parcel.invoice.totalAmount.currency} ${parcel.invoice.totalAmount.value.toFixed(2)}`;
    
    // Download invoice button
    qs('downloadInvoiceBtn').addEventListener('click', () => {
      generateInvoicePDF(parcel, ref);
    });
  }

  // Status list
  const statusList = qs('statusList');
  parcel.journey.slice().reverse().forEach(step => {
    const li = document.createElement('li');
    li.className = 'status-item';
    li.textContent = step;
    statusList.appendChild(li);
  });

  // Progress bar
  const progressFill = qs('progressFill');
  const dot1 = qs('dot1'), dot2 = qs('dot2'), dot3 = qs('dot3');
  
  let percent = 10;
  if (parcel.status === 'in_transit') {
    percent = 66;
    dot1.classList.add('active');
    dot2.classList.add('active');
  } else if (parcel.status === 'delivered') {
    percent = 100;
    dot1.classList.add('active');
    dot2.classList.add('active');
    dot3.classList.add('active');
  } else {
    dot1.classList.add('active');
  }
  
  progressFill.style.width = percent + '%';
  progressFill.setAttribute('aria-valuenow', percent);

  // Initialize map
  try {
    const map = L.map('map', { zoomControl: true }).setView(parcel.coords, 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    
    const marker = L.marker(parcel.coords, { title: parcel.checkpoint }).addTo(map);
    marker.bindPopup(parcel.checkpoint).openPopup();
    qs('coordsText').textContent = parcel.coords.join(', ');
  } catch (e) {
    console.error('Map init error', e);
    qs('map').style.display = 'none';
    qs('mapFallback').style.display = 'block';
  }

  // Generate QR code
  try {
    const container = qs('qrCodeContainer');
    const url = `${location.origin}${location.pathname}?ref=${encodeURIComponent(ref)}`;
    const canvas = document.createElement('canvas');
    
    QRCode.toCanvas(canvas, url, { width: 160 }, (err) => {
      if (err) {
        console.error(err);
        container.textContent = 'QR unavailable';
        return;
      }
      container.appendChild(canvas);
      
      qs('downloadQrBtn').onclick = () => {
        const link = document.createElement('a');
        link.download = `${ref}.png`;
        link.href = canvas.toDataURL();
        link.click();
      };
    });
  } catch (e) {
    console.warn('QR error', e);
  }

  // Copy function
  function copyText(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      return navigator.clipboard.writeText(text);
    } else {
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      return Promise.resolve();
    }
  }

  // Copy button handlers
  qs('copyBtn').addEventListener('click', () => {
    copyText(ref).then(() => {
      alert('Tracking number copied!');
    }).catch(() => {
      alert('Copy failed');
    });
  });

  qs('copyInline').addEventListener('click', () => {
    copyText(ref).then(() => {
      alert('Copied!');
    }).catch(() => {
      alert('Copy failed');
    });
  });

  // Share button
  qs('shareBtn').addEventListener('click', async () => {
    const shareUrl = `${location.origin}${location.pathname}?ref=${encodeURIComponent(ref)}`;
    if (navigator.share) {
      try {
        await navigator.share({
          title: `Parcel ${ref}`,
          url: shareUrl
        });
      } catch(e) {
        // User canceled
      }
    } else {
      copyText(shareUrl).then(() =>
        alert('Share link copied to clipboard!')
      ).catch(() =>
        alert('Unable to share')
      );
    }
  });

  // Directions button
  qs('directionsBtn').addEventListener('click', () => {
    const [lat, lon] = parcel.coords;
    const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
    window.open(mapsUrl, '_blank', 'noopener');
  });

  // Update time periodically
  setInterval(() => {
    qs('lastUpdated').textContent = 'Last update: ' + formatISONow();
  }, 60000);

  // Function to generate invoice PDF (simple text-based)
  function generateInvoicePDF(parcel, trackingRef) {
    const invoice = parcel.invoice;
    
    // Create a printable invoice HTML
    const invoiceWindow = window.open('', '_blank');
    invoiceWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Invoice ${invoice.invoiceNumber}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
          .header { text-align: center; border-bottom: 3px solid #9B0F22; padding-bottom: 20px; margin-bottom: 30px; }
          .header h1 { color: #9B0F22; margin: 0; }
          .info-section { margin: 20px 0; }
          .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
          .info-label { font-weight: bold; color: #666; }
          .charges { margin: 30px 0; }
          .charge-item { display: flex; justify-content: space-between; padding: 10px 0; }
          .total { font-size: 1.2em; font-weight: bold; color: #9B0F22; border-top: 2px solid #9B0F22; padding-top: 15px; margin-top: 15px; }
          .footer { margin-top: 50px; text-align: center; color: #666; font-size: 0.9em; }
          @media print { body { padding: 20px; } }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>PARCELFORCE INTERNATIONAL</h1>
          <p>Commercial Invoice</p>
        </div>
        
        <div class="info-section">
          <div class="info-row">
            <span class="info-label">Invoice Number:</span>
            <span>${invoice.invoiceNumber}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Date Issued:</span>
            <span>${invoice.dateIssued}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Tracking Number:</span>
            <span>${trackingRef}</span>
          </div>
        </div>
        
        <div class="info-section">
          <h3>Sender Details</h3>
          <div class="info-row">
            <span class="info-label">Name:</span>
            <span>${parcel.sender.name}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Address:</span>
            <span>${parcel.sender.address}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Phone:</span>
            <span>${parcel.sender.phone || 'N/A'}</span>
          </div>
        </div>
        
        <div class="info-section">
          <h3>Recipient Details</h3>
          <div class="info-row">
            <span class="info-label">Name:</span>
            <span>${parcel.recipient.name}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Address:</span>
            <span>${parcel.recipient.address}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Phone:</span>
            <span>${parcel.recipient.phone || 'N/A'}</span>
          </div>
        </div>
        
        <div class="info-section">
          <h3>Shipment Details</h3>
          <div class="info-row">
            <span class="info-label">Description:</span>
            <span>${invoice.description}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Weight:</span>
            <span>${invoice.weight}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Expected Delivery:</span>
            <span>${parcel.deliveryDate}</span>
          </div>
        </div>
        
        <div class="charges">
          <h3>Charges</h3>
          ${invoice.charges.map(charge => `
            <div class="charge-item">
              <span>${charge.item}</span>
              <span>${charge.currency} ${charge.amount.toFixed(2)}</span>
            </div>
          `).join('')}
          
          <div class="total">
            <div style="display: flex; justify-content: space-between;">
              <span>Total Amount:</span>
              <span>${invoice.totalAmount.currency} ${invoice.totalAmount.value.toFixed(2)}</span>
            </div>
          </div>
          
          <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ff9800; border-radius: 8px;">
            <strong>Payment Status:</strong> ${invoice.paymentStatus}
          </div>
        </div>
        
        <div class="footer">
          <p>ParcelForce International Courier &copy; ${new Date().getFullYear()}</p>
          <p>For inquiries, contact: support@parcelforce.com</p>
        </div>
        
        <script>
          window.onload = () => {
            setTimeout(() => window.print(), 500);
          };
        </script>
      </body>
      </html>
    `);
    invoiceWindow.document.close();
  }

})();
</script>
</body>
</html>
