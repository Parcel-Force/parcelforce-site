<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Parcels | ParcelForce</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <style>
    :root {
      --red: #9B0F22;         /* darker red you preferred */
      --dark-red: #7F0D1A;
      --dark: #1f1f1f;
      --light: #f9f9f9;
      --white: #fff;
      --text: #333;
      --success: #28a745;
      --warning: #ffc107;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
    }

    body.dark-mode { background: var(--dark); color: var(--white); }

    header {
      background: var(--red);
      color: var(--white);
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0; z-index: 1000;
    }

    header .header-content {
      max-width: 1200px; margin: 0 auto; display:flex; align-items:center; gap:12px; justify-content:space-between;
    }
    .logo { height:40px; border-radius:8px; display:block; object-fit:contain; }

    #sessionBanner {
      display: none;
      background-color: #fff3cd;
      color: #856404;
      padding: 12px;
      text-align: center;
      border-bottom: 2px solid var(--warning);
      font-weight: bold;
      animation: slideDown 0.3s ease;
    }
    @keyframes slideDown { from { opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }

    body.dark-mode #sessionBanner { background-color:#3a3a1a; color:var(--warning); }

    main { max-width:1200px; margin:0 auto; padding:40px 20px; }

    .dashboard { background: var(--white); border-radius:16px; padding:40px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
    body.dark-mode .dashboard { background:#2a2a2a; }

    h2 { color: var(--red); font-size:2.2em; text-align:center; margin-bottom:12px; }
    body.dark-mode h2 { color:#ff4d6d; }

    #userEmail { text-align:center; font-size:1.05rem; color:#666; margin-bottom:6px; }
    body.dark-mode #userEmail { color:#aaa; }

    #welcomeMessage { text-align:center; font-size:1.05rem; margin-bottom:20px; color:var(--success); font-weight:500; }

    .dashboard-actions { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-bottom:30px; }
    .dashboard-actions a, .dashboard-actions button {
      flex: 1 1 180px; max-width:220px; padding:10px 16px; background:var(--red); color:var(--white);
      border:none; border-radius:8px; font-size:15px; font-weight:700; cursor:pointer; text-decoration:none; text-align:center;
      transition:all .18s ease; box-shadow:0 6px 18px rgba(0,0,0,0.06);
    }
    .dashboard-actions a:hover, .dashboard-actions button:hover { background:var(--dark-red); transform:translateY(-2px); }

    .dark-mode-toggle {
      flex: 1 1 180px; max-width:220px; display:flex; gap:10px; align-items:center; justify-content:center;
      padding:10px 16px; background:transparent; border:2px solid var(--red); border-radius:8px; cursor:pointer;
    }
    .dark-mode-toggle:hover { background:var(--red); color:var(--white); transform:translateY(-2px); }

    #modeIcon { font-size:1.2em; transition: transform .2s ease; }

    #parcelList { margin-top:20px; min-height:120px; }

    .parcel-card {
      background:#f9f9f9; border: 1px solid #e6e6e6; border-radius:12px; padding:16px; margin-bottom:14px;
      transition:all .18s ease; cursor:default;
    }
    .parcel-card:hover { transform:translateY(-3px); box-shadow:0 8px 26px rgba(0,0,0,0.06); border-color:var(--red); }
    body.dark-mode .parcel-card { background:#2c2c2c; border-color:#444; color:#f0f0f0; }
    .parcel-card h3 { color:var(--red); margin-bottom:10px; font-size:1.15rem; }
    .parcel-card p { margin:6px 0; line-height:1.5; }
    .parcel-card strong { color:var(--red); }

    .status-badge { display:inline-block; padding:6px 12px; border-radius:20px; font-size:0.9rem; font-weight:700; margin-top:8px; }
    .status-picked-up { background:#d1ecf1; color:#0c5460; }
    .status-in-transit { background:#fff3cd; color:#856404; }
    .status-delivered { background:#d4edda; color:#155724; }

    .view-details-btn { display:inline-block; margin-top:10px; padding:6px 12px; background:var(--red); color:#fff; border-radius:8px; border:none; font-weight:700; cursor:pointer; }
    .view-details-btn:hover { background:var(--dark-red); }

    .spinner { display:block; width:48px; height:48px; border:5px solid #e6e6e6; border-top:5px solid var(--red); border-radius:50%; animation:spin 1s linear infinite; margin:26px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state { text-align:center; padding:40px 12px; }
    .empty-state h3 { color:#777; margin-bottom:12px; font-size:1.1rem; }
    .empty-state p { color:#666; margin-bottom:18px; }
    .view-details-link { display:inline-block; padding:8px 14px; border-radius:8px; background:var(--red); color:white; text-decoration:none; font-weight:700; }

    footer { background:#2a2a2a; color:white; text-align:center; padding:30px 20px; margin-top:40px; }
    footer p { margin:10px 0; opacity:0.9; font-size:0.95rem; }

    @media (max-width: 768px) {
      .dashboard { padding:24px; }
      h2 { font-size:1.6rem; }
      .dashboard-actions { flex-direction:column; }
      .dashboard-actions a, .dashboard-actions button, .dark-mode-toggle { max-width:100%; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div style="display:flex;align-items:center;gap:12px">
        <img src="logo.png" alt="ParcelForce Logo" class="logo" onerror="this.style.display='none'"/>
        <div>
          <div style="font-weight:700">ParcelForce</div>
          <div style="font-size:0.85rem;opacity:0.9">Dashboard</div>
        </div>
      </div>
      <div style="font-size:0.95rem;opacity:0.9">Welcome to your dashboard</div>
    </div>
  </header>

  <div id="sessionBanner" role="status" aria-live="polite">‚ö†Ô∏è Your session has expired. Please log in again.</div>

  <main>
    <div class="dashboard" role="main" aria-labelledby="dashboardTitle">
      <h2 id="dashboardTitle">üì¶ My Parcels</h2>
      <p id="userEmail" aria-live="polite"></p>
      <p id="welcomeMessage" aria-live="polite"></p>

      <div class="dashboard-actions" role="toolbar" aria-label="Dashboard actions">
        <a href="index.html" aria-label="Track a new parcel">‚ûï Track New Parcel</a>
        <button id="printBtn" type="button" onclick="window.print()" aria-label="Print your parcel list">üñ®Ô∏è Print</button>
        <button id="logoutBtn" type="button" aria-label="Logout from your account">üö™ Logout</button>
        <button class="dark-mode-toggle" id="darkToggle" type="button" aria-pressed="false" aria-label="Toggle dark mode">
          <span class="toggle-label">Dark Mode</span>
          <span id="modeIcon">üåô</span>
        </button>
      </div>

      <div id="parcelList" aria-live="polite">
        <div class="spinner" role="status" aria-label="Loading parcels"></div>
      </div>
    </div>
  </main>

  <footer>
    <p><strong>ParcelForce International Courier</strong> &copy; <span id="year"></span>. All rights reserved.</p>
    <p>Privacy | Terms | Accessibility</p>
  </footer>

  <script>
    // Dashboard ‚Äî local-only version (Firebase removed)
    // Simulated auth/session and parcel loading using localStorage for demo/editing purposes.
    (function () {
      const STORAGE_USER_KEY = 'pf_current_user';
      const STORAGE_PARCELS_KEY = 'pf_parcels';

      const sessionBanner = document.getElementById('sessionBanner');
      const userEmailEl = document.getElementById('userEmail');
      const welcomeEl = document.getElementById('welcomeMessage');
      const parcelListEl = document.getElementById('parcelList');
      const logoutBtn = document.getElementById('logoutBtn');
      const darkToggle = document.getElementById('darkToggle');
      const modeIcon = document.getElementById('modeIcon');
      const yearEl = document.getElementById('year');

      yearEl.textContent = new Date().getFullYear();

      // Basic helpers
      function getCurrentUser() {
        try { return JSON.parse(localStorage.getItem(STORAGE_USER_KEY)); } catch (e) { return null; }
      }
      function setCurrentUser(u) {
        try { if (u) localStorage.setItem(STORAGE_USER_KEY, JSON.stringify(u)); else localStorage.removeItem(STORAGE_USER_KEY); } catch(e) {}
      }
      function getParcels() {
        try { return JSON.parse(localStorage.getItem(STORAGE_PARCELS_KEY) || 'null') || []; } catch (e) { return []; }
      }
      function saveParcels(list) { try { localStorage.setItem(STORAGE_PARCELS_KEY, JSON.stringify(list || [])); } catch (e) {} }

      // Provide sample parcels if none exist (developer-friendly)
      function ensureSampleParcels() {
        const existing = getParcels();
        if (!existing || existing.length === 0) {
          const sample = [
            { id: "PF557690344CN", status: "In Transit", recipient: "Ella I. Pelling", destination: "Horsham, UK", estimatedDelivery: "2025-11-25" },
            { id: "RB123456789CN", status: "Collected", recipient: "Doreen van der Merwe", destination: "Pretoria, ZA", estimatedDelivery: "2025-11-26" }
          ];
          saveParcels(sample);
          return sample;
        }
        return existing;
      }

      // UI: render parcels
      function displayParcels(parcels) {
        parcelListEl.innerHTML = '';
        if (!parcels || parcels.length === 0) {
          parcelListEl.innerHTML = `
            <div class="empty-state" role="region" aria-label="Empty state">
              <h3>üì≠ No parcels yet</h3>
              <p>You don't have any tracked parcels at the moment.</p>
              <a href="index.html" class="view-details-link">Track Your First Parcel</a>
            </div>`;
          return;
        }

        const fragment = document.createDocumentFragment();
        parcels.forEach(p => {
          const card = document.createElement('div');
          card.className = 'parcel-card';
          const statusClass = (p.status && p.status.toLowerCase().includes('transit')) ? 'status-in-transit'
                             : (p.status && p.status.toLowerCase().includes('deliv')) ? 'status-delivered'
                             : 'status-picked-up';
          card.innerHTML = `
            <h3>üì¶ ${escapeHtml(p.id)}</h3>
            <p><strong>Status:</strong> <span class="status-badge ${statusClass}">${escapeHtml(p.status || 'Unknown')}</span></p>
            <p><strong>Recipient:</strong> ${escapeHtml(p.recipient || 'N/A')}</p>
            <p><strong>Destination:</strong> ${escapeHtml(p.destination || 'N/A')}</p>
            <p><strong>Est. Delivery:</strong> ${escapeHtml(p.estimatedDelivery || 'N/A')}</p>
            <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
              <button class="view-details-btn" data-id="${escapeHtml(p.id)}">View Details ‚Üí</button>
              <button class="view-details-btn" data-action="remove" data-id="${escapeHtml(p.id)}" style="background:#666">Remove</button>
            </div>
          `;
          fragment.appendChild(card);
        });
        parcelListEl.appendChild(fragment);
      }

      // Escape to prevent injection (basic)
      function escapeHtml(str) {
        if (!str && str !== 0) return '';
        return String(str).replace(/[&<>"']/g, s => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s]));
      }

      // Load flow
      function initDashboard() {
        const user = getCurrentUser();
        if (!user || !user.email) {
          // not logged in ‚Äî show banner and redirect to auth page after a short delay
          sessionBanner.style.display = 'block';
          setTimeout(() => { window.location.href = 'auth.html'; }, 2200);
          return;
        }

        // show user info
        userEmailEl.textContent = `üìß ${user.email}`;
        welcomeEl.textContent = `Welcome back, ${user.name || (user.email.split('@')[0])}!`;

        // load parcels (simulate async)
        setTimeout(() => {
          const parcels = ensureSampleParcels();
          displayParcels(parcels);
        }, 600);
      }

      // Event delegation for parcel actions (view details / remove)
      parcelListEl.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-id]');
        if (!btn) return;
        const id = btn.getAttribute('data-id');
        const action = btn.getAttribute('data-action') || 'view';
        if (action === 'view') {
          // navigate to track page (same UX as before)
          window.location.href = `track.html?ref=${encodeURIComponent(id)}`;
        } else if (action === 'remove') {
          if (!confirm(`Remove parcel ${id} from your list? This is local only.`)) return;
          const parcels = getParcels().filter(p => p.id !== id);
          saveParcels(parcels);
          displayParcels(parcels);
        }
      });

      // Logout: clear demo session and redirect to auth
      logoutBtn.addEventListener('click', () => {
        setCurrentUser(null);
        // optionally keep parcels persisted; you can clear them by uncommenting the next line
        // saveParcels([]);
        window.location.href = 'auth.html';
      });

      // Dark mode toggle + persistence
      function applyDarkPreference() {
        const dark = localStorage.getItem('darkMode') === 'true';
        if (dark) { document.body.classList.add('dark-mode'); modeIcon.textContent = '‚òÄÔ∏è'; darkToggle.setAttribute('aria-pressed','true'); }
        else { document.body.classList.remove('dark-mode'); modeIcon.textContent = 'üåô'; darkToggle.setAttribute('aria-pressed','false'); }
      }
      darkToggle.addEventListener('click', () => {
        const isDark = document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', isDark ? 'true' : 'false');
        modeIcon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        darkToggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
      });

      // Small accessibility: allow keyboard activation for dashboard buttons
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          // clear session banner if visible
          if (sessionBanner.style.display === 'block') sessionBanner.style.display = 'none';
        }
      });

      // If no user exists, create a demo user for easier local testing (optional)
      function ensureDemoUser() {
        let u = getCurrentUser();
        if (!u) {
          u = { email: 'demo@parcelforce.test', name: 'Demo User' };
          setCurrentUser(u);
        }
      }

      // Initialize
      ensureDemoUser();    // remove this in production ‚Äî helpful while developing locally
      applyDarkPreference();
      initDashboard();
    })();
  </script>
</body>
</html>